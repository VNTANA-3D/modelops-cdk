---
name: Other
description: Downloads an asset from S3
state:
  optimized: /home/workspace/optimized.glb
  suffix: optimized
  extension: glb
  # Name of the asset to be optimized.
  # NOTE: Don't include the extension in the name.
  src: YOUR_UNOPTIMIZED_ASSET_NAME
  # Destination name of the optimized assets. It'll use the provided suffix to craft
  # the complete name of each file generated by the optimiser (GLB, FBX, and USD).
  # NOTE: Defaults to the original asset name.
  dest: "{{ name }}"
  # S3 Bucket name
  bucket: YOUR_S3_BUCKET
  # Assets root path.
  root: assets
tasks:
  - name: Download Asset
    module: S3
    props:
      src: "{{ root }}/{{ name }}.{{ extension }}"
      dest: "{{ name }}.{{ extension }}"
      bucket: "{{ bucket }}"
      action: download
    register: asset
  - module: MeshOptimizer
    props:
      src: "{{ asset.dest }}"
      dest: "{{ optimized }}"
      config:
        detect_instances: true
        reset_scaling: true
        pot_textures: true
        ignore_parallel_geometry: true
        bake_small_features: true
        skip_material_visibility: true
        target_tex_density: 3000
    register: optimized
  - name: Debug download output
    module: Debug
    props:
      var: optimized
      format: yaml
  - name: Upload Optimized GLB
    module: S3
    props:
      src: "{{ optimized.dest }}"
      dest: "{{ root }}/{{ name }}.{{ suffix }}.glb"
      bucket: "{{ bucket }}"
      action: upload
  - name: Upload Optimized FBX
    module: S3
    props:
      src: "{{ optimized.fbxDest }}"
      dest: "{{ root }}/{{ name }}.{{ suffix }}.fbx"
      bucket: "{{ bucket }}"
      action: upload
  - name: Upload Optimized USD
    module: S3
    props:
      src: "{{ optimized.usdDest }}"
      dest: "{{ root }}/{{ name }}.{{ suffix }}.usd"
      bucket: "{{ bucket }}"
      action: upload
